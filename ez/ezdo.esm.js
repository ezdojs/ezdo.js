import e from"shortid";var t=new class{addEvent(e,t,s,i){var r,n,l;null==i&&(i=!0);try{l=!!window.navigator.msPointerEnabled}catch(e){l=!1}try{r="ontouchstart"in document&&!isPC()}catch(e){r=!1}try{n=!!("ontouchstart"in document&&isPC())}catch(e){n=!1}var a=null;if(l)switch(t){case"mousedown":t="MSPointerDown";break;case"mousemove":t="MSPointerMove";break;case"mouseup":t="MSPointerUp";break;case"mouseover":t="MSPointerOver";break;case"mouseout":t="MSPointerOut"}else if(r)switch(t){case"mousedown":t="touchstart";break;case"mousemove":t="touchmove";break;case"mouseup":t="touchend";break;case"mouseover":case"mouseout":t=""}if(n)switch(t){case"mousedown":a="touchstart";break;case"mousemove":a="touchmove";break;case"mouseup":a="touchend";break;case"mouseover":case"mouseout":a=""}""!=t&&(e._plisteners||(e._plisteners={}),e._plisteners[t]=s,e.addEventListener?e.addEventListener(t,s,i):e.attachEvent?e.attachEvent("on"+t,s):e["on"+t]=s,a&&(e.addEventListener?e.addEventListener(a,s,i):e.attachEvent?e.attachEvent("on"+a,s):e["on"+a]=s))}removeEvent(e,t,s,i){var r,n,l;null==i&&(i=!0);try{l=!!window.navigator.msPointerEnabled}catch(e){l=!1}try{r="ontouchstart"in document&&!isPC()}catch(e){r=!1}try{n=!!("ontouchstart"in document&&isPC())}catch(e){n=!1}var a=null;if(l)switch(t){case"mousedown":t="MSPointerDown";break;case"mousemove":t="MSPointerMove";break;case"mouseup":t="MSPointerUp";break;case"mouseover":t="MSPointerOver";break;case"mouseout":t="MSPointerOut"}else if(r)switch(t){case"mousedown":t="touchstart";break;case"mousemove":t="touchmove";break;case"mouseup":t="touchend";break;case"mouseover":case"mouseout":t=""}if(n)switch(t){case"mousedown":a="touchstart";break;case"mousemove":a="touchmove";break;case"mouseup":a="touchend";break;case"mouseover":case"mouseout":a=""}e._plisteners&&delete e._plisteners[t],e.removeEventListener?e.removeEventListener(t,s,i):e.detachEvent?e.detachEvent("on"+t,s):e["on"+t]=null,a&&(e.removeEventListener?e.removeEventListener(a,s,i):e.detachEvent?e.detachEvent("on"+a,s):e["on"+a]=null)}isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,i=0;i<t.length;i++)if(e.indexOf(t[i])>0){s=!1;break}return s}};class s{constructor(){this.el=null,this.vn=null}}class i extends Map{constructor(){super()}}var r=new i;class n{constructor(e){this.mFragment=e}newFragment(e,t){t||(t=this.mFragment);let s=this.newView(e);if(t.appendChild(s),this._updateNode(e),e.children&&e.children.length){let t=e.children.length;for(var i=0;i<t;i++)this.newFragment(e.children[i],s)}}render(e){let t=e.get("node"),s=t._eid,i=null;switch(e.get("cmd")){case"del":i=r.get(s),i&&i.el&&i.el.parentNode&&i.el.parentNode.removeChild(i.el),r.delete(s);break;case"add":i=r.get(e.get("parent")._eid),this.newFragment(t,i.el);break;case"mod":this._updateNode(t)}}_updateNode(e){let s=r.get(e._eid);if(s){let r=s.el;if(e._attr)for(var i in e._attr){let t=e._attr[i];t instanceof Array&&(t.length?t=t.join(" "):(t=null,r.removeAttribute(i))),t&&r.getAttribute(i)!=t&&r.setAttribute(i,t)}if(e._listener){for(var i in r._plisteners)e._listener[i]||t.removeEvent(r,i,this.handlerProxy);for(var i in e._listener)r._plisteners&&r._plisteners[i]||t.addEvent(r,i,this.handlerProxy)}e.html&&(r.innerHTML=e.html)}}handlerProxy(e){let t=e||event;if(!t)return void console.warn("evt is undefined");if(!t.target.__ez__eid)return void console.warn("not found element");let s=r.get(t.target.__ez__eid);s&&"input"===s.vn.type&&s.vn._attr._value!=s.el.value&&(s.vn._attr._value=s.el.value);let i=s.vn._listener[t.type];i&&i(s.vn),e?(e.stopPropagation(),e.preventDefault()):(window.event.returnValue=!1,window.event.cancelBubble=!0)}newView(e){let t=null;"cd"===e._ez_create_type?t=document.createElement(e.type):"new"===e._ez_create_type&&"Text"===e.type&&(t=new Text(e._ez_data)),t.__ez__eid=e._eid;let i=new s;return i.el=t,i.vn=e,r.set(e._eid,i),t}el2vn(e){}}var l=new class{constructor(){this.isInit=!1}render(e){this.isInit&&e.forEach(e=>{let t=new n(this.newVContainer());t.render(e),t=null})}init(e,t){if(this.isInit)return;let i=document.getElementById(t);if(i){let t="puc"+(Math.floor(2e3*Math.random())+100);i._eid=t;let l=new s;l.el=i,r.set(t,l);let a=new n(this.newVContainer());a.newFragment(e),i.appendChild(a.mFragment),a=null,this.isInit=!0}}newVContainer(){return document.createDocumentFragment()}};var a=new class{constructor(){this.renderTime=20,this.timeId=0,this.shell_add="add",this.shell_del="del",this.shell_mod="mod",this.ctrl_class="class",this.ctrl_attr="attr",this.ctrl_text="text",this.ctrl_node="node",this.ctrl_event="event",this.tasks=[],this.shells=new Map}_ez_hasParentIsAdd(e){for(let t of this.shells.values())if(t&&t.get("node")._eid===e.parent._eid&&t.get("cmd")!==this.shell_mod)return!0;return!1}_ez_handle(){let e=[];for(this.shells.forEach(t=>{if("add"===t.get("cmd")){let s=t.get("node");this._ez_hasParentIsAdd(s)&&e.push(s._eid)}});e.length;){let t=e.shift();this.shells.delete(t)}}push(){0===this.timeId&&(this.timeId=setTimeout(()=>{this._ez_handle(),l.render(this.shells),this.shells.clear(),clearTimeout(this.timeId),this.timeId=0},this.renderTime))}commit(e,t,s,i){if(!l.isInit||!s.parent)return;let r=this.shells.get(s._eid);if(r)r.get("cmd")===this.shell_mod?r.set("cmd",e):e!==this.shell_mod&&r.set("cmd",e);else{let t=new Map;t.set("cmd",e),t.set("node",s),this.shells.set(s._eid,t)}i&&this.shells.get(s._eid).set("parent",i),this.push()}};class o{constructor(){this._eid=e.generate(),this._ename="ezobj",this._isVdom=!0,this._ez_create_type="cd"}_ez_del_attr(e){delete this[e]}}class h extends o{constructor(){super(),this._ez_data="",this._ez_create_type="new",this.type="Text"}set text(e){this._ez_data!==e&&(this._ez_data=e,a.commit(a.shell_mod,a.ctrl_text,this,null))}get text(){return this._ez_data}}class d extends o{constructor(e){super(),this.type=e||"div",this._attr={class:[],value:void 0,id:void 0},this.children=[],this._listener={},this.ezText=null,this.parent=null,this._ez_html_str=""}on(e,t,s){this._listener[e]=t.bind(s||this),a.commit(a.shell_mod,a.ctrl_event,this,null)}off(e,t){delete this._listener[e],a.commit(a.shell_mod,a.ctrl_event,this,null)}add(e){return e.parent=this,this.children.push(e),a.commit(a.shell_add,a.ctrl_node,e,this),this}remove(e){for(var t=this.children.length-1;t>=0;t--){let s=this.children[t];if(e._elId===s._elId){this.children.splice(t,1);break}}for(var s in a.commit(a.shell_del,a.ctrl_node,e,this),this){let t=this[s];if(t&&t._ename&&t._eid===e._eid){this._ez_del_attr(s);break}}return this}removeAll(){for(;this.children.length;)this.remove(this.children[this.children.length-1])}addAttr(e,t){this._attr[e]=t,a.commit(a.shell_mod,a.ctrl_attr,this,null)}removeAttr(e,t){delete this._attr[e],a.commit(a.shell_mod,a.ctrl_attr,this,null)}addClass(e){this._attr.class.push(e),a.commit(a.shell_mod,a.ctrl_attr,this,null)}removeClass(e){this._attr.class=this._attr.class.filter(t=>t!==e),a.commit(a.shell_mod,a.ctrl_attr,this,null)}set value(e){this._attr.value!==e&&(this._attr._value=e,a.commit(a.shell_mod,a.ctrl_text,this,null))}get value(){return this._attr._value}set id(e){this._attr.id!==e&&(this._attr.id=e,a.commit(a.shell_mod,a.ctrl_text,this,null))}get id(){return this._attr.id}set text(e){this.ezText||(this.ezText=new h,this.add(this.ezText)),this.ezText.text!==e&&(this.ezText.text=e)}get text(){return this.ezText?this.ezText.text:""}get html(){return this._ez_html_str}set html(e){e!==this._ez_html_str&&(this._ez_html_str=e,a.commit(a.shell_mod,a.ctrl_text,this,null))}}class c extends d{constructor(){super("a"),this.addClass("link"),this.addAttr("href","javascript:")}}class u extends d{constructor(){super("img")}set src(e){this._attr.src=e}get src(){return this._attr.src}}class m extends d{}class _ extends d{constructor(){super("input"),this.on("input",this.onInput),this.change=null}onInput(){this.change&&this.change(this.value)}}var v=new class{constructor(){this.type="Body",this.Node=d,this.Link=c,this.Image=u,this.Video=m,this.Input=_,this.appId="app"}render(e){l.init(e,this.appId)}renderTo(e,t){this.appId=t,this.render(e)}use(e){e?e.name?(this[e.name]&&console.log("已经存在同名模块，将会覆盖之前的模板"),this[e.name]=e):console.log("您的模块不存在name属性，将无法进行处理"):console.log("您将绑定一个空白对象")}};export default v;
