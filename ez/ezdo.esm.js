import e from"shortid";var t=new class{addEvent(e,t,s,r){var i,n,a;null==r&&(r=!0);try{a=!!window.navigator.msPointerEnabled}catch(e){a=!1}try{i="ontouchstart"in document&&!isPC()}catch(e){i=!1}try{n=!!("ontouchstart"in document&&isPC())}catch(e){n=!1}var o=null;if(a)switch(t){case"mousedown":t="MSPointerDown";break;case"mousemove":t="MSPointerMove";break;case"mouseup":t="MSPointerUp";break;case"mouseover":t="MSPointerOver";break;case"mouseout":t="MSPointerOut"}else if(i)switch(t){case"mousedown":t="touchstart";break;case"mousemove":t="touchmove";break;case"mouseup":t="touchend";break;case"mouseover":case"mouseout":t=""}if(n)switch(t){case"mousedown":o="touchstart";break;case"mousemove":o="touchmove";break;case"mouseup":o="touchend";break;case"mouseover":case"mouseout":o=""}""!=t&&(e._plisteners||(e._plisteners={}),e._plisteners[t]=s,e.addEventListener?e.addEventListener(t,s,r):e.attachEvent?e.attachEvent("on"+t,s):e["on"+t]=s,o&&(e.addEventListener?e.addEventListener(o,s,r):e.attachEvent?e.attachEvent("on"+o,s):e["on"+o]=s))}removeEvent(e,t,s,r){var i,n,a;null==r&&(r=!0);try{a=!!window.navigator.msPointerEnabled}catch(e){a=!1}try{i="ontouchstart"in document&&!isPC()}catch(e){i=!1}try{n=!!("ontouchstart"in document&&isPC())}catch(e){n=!1}var o=null;if(a)switch(t){case"mousedown":t="MSPointerDown";break;case"mousemove":t="MSPointerMove";break;case"mouseup":t="MSPointerUp";break;case"mouseover":t="MSPointerOver";break;case"mouseout":t="MSPointerOut"}else if(i)switch(t){case"mousedown":t="touchstart";break;case"mousemove":t="touchmove";break;case"mouseup":t="touchend";break;case"mouseover":case"mouseout":t=""}if(n)switch(t){case"mousedown":o="touchstart";break;case"mousemove":o="touchmove";break;case"mouseup":o="touchend";break;case"mouseover":case"mouseout":o=""}e._plisteners&&delete e._plisteners[t],e.removeEventListener?e.removeEventListener(t,s,r):e.detachEvent?e.detachEvent("on"+t,s):e["on"+t]=null,o&&(e.removeEventListener?e.removeEventListener(o,s,r):e.detachEvent?e.detachEvent("on"+o,s):e["on"+o]=null)}isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,r=0;r<t.length;r++)if(e.indexOf(t[r])>0){s=!1;break}return s}};class s{constructor(){this.el=null,this.vn=null}}class r extends Map{constructor(){super()}}var i=new r;class n{constructor(e){this.mFragment=e}newFragment(e,t){t||(t=this.mFragment);let s=this.newView(e);if(t.appendChild(s),this._updateNode(e),e.children&&e.children.length){let t=e.children.length;for(var r=0;r<t;r++)this.newFragment(e.children[r],s)}}render(e){let t=e.get("node"),s=t._eid,r=null;switch(e.get("cmd")){case"del":r=i.get(s),r&&r.el&&r.el.parentNode&&r.el.parentNode.removeChild(r.el),i.delete(s);break;case"add":r=i.get(e.get("parent")._eid),this.newFragment(t,r.el);break;case"mod":this._updateNode(t)}}_updateNode(e){let s=i.get(e._eid);if(s){let i=s.el;if(e._attr)for(var r in e._attr){let t=e._attr[r];t instanceof Array&&(t.length?t=t.join(" "):(t=null,i.removeAttribute(r))),t&&i.getAttribute(r)!=t&&i.setAttribute(r,t)}if(e._listener){for(var r in i._plisteners)e._listener[r]||t.removeEvent(i,r,this.handlerProxy);for(var r in e._listener)i._plisteners&&i._plisteners[r]||t.addEvent(i,r,this.handlerProxy)}}}handlerProxy(e){let t=e||event;if(!t)return void console.warn("evt is undefined");if(!t.target.__ez__eid)return void console.warn("not found element");let s=i.get(t.target.__ez__eid),r=s.vn._listener[t.type];r&&r(s.vn),e?(e.stopPropagation(),e.preventDefault()):(window.event.returnValue=!1,window.event.cancelBubble=!0)}newView(e){let t=null;"cd"===e._ez_create_type?t=document.createElement(e.type):"new"===e._ez_create_type&&"Text"===e.type&&(t=new Text(e._ez_data)),t.__ez__eid=e._eid;let r=new s;return r.el=t,r.vn=e,i.set(e._eid,r),t}}var a=new class{constructor(){this.isInit=!1}render(e){this.isInit&&e.forEach(e=>{let t=new n(this.newVContainer());t.render(e),t=null})}init(e,t){if(this.isInit)return;let r=document.getElementById(t);if(r){let t="puc"+(Math.floor(2e3*Math.random())+100);r._eid=t;let a=new s;a.el=r,i.set(t,a);let o=new n(this.newVContainer());o.newFragment(e),r.appendChild(o.mFragment),o=null,this.isInit=!0}}newVContainer(){return document.createDocumentFragment()}};var o=new class{constructor(){this.renderTime=20,this.timeId=0,this.shell_add="add",this.shell_del="del",this.shell_mod="mod",this.ctrl_class="class",this.ctrl_attr="attr",this.ctrl_text="text",this.ctrl_node="node",this.ctrl_event="event",this.tasks=[],this.shells=new Map}_ez_hasParentIsAdd(e){for(let t of this.shells.values())if(t&&t.get("node")._eid===e.parent._eid&&t.get("cmd")!==this.shell_mod)return!0;return!1}_ez_handle(){let e=[];for(this.shells.forEach(t=>{if("add"===t.get("cmd")){let s=t.get("node");this._ez_hasParentIsAdd(s)&&e.push(s._eid)}});e.length;){let t=e.shift();this.shells.delete(t)}}push(){0===this.timeId&&(this.timeId=setInterval(()=>{this._ez_handle(),a.render(this.shells),this.shells.clear(),clearInterval(this.timeId),this.timeId=0},this.renderTime))}commit(e,t,s,r){if(!a.isInit||!s.parent)return;let i=this.shells.get(s._eid);if(i)i.get("cmd")===this.shell_mod?i.set("cmd",e):e!==this.shell_mod&&i.set("cmd",e);else{let t=new Map;t.set("cmd",e),t.set("node",s),this.shells.set(s._eid,t)}r&&this.shells.get(s._eid).set("parent",r),this.push()}};class l{constructor(){this._eid=e.generate(),this._ename="ezobj",this._isVdom=!0,this._ez_create_type="cd"}_ez_del_attr(e){delete this[e]}}class h extends l{constructor(){super(),this._ez_data="",this._ez_create_type="new",this.type="Text"}set text(e){this._ez_data!==e&&(this._ez_data=e,o.commit(o.shell_mod,o.ctrl_text,this,null))}get text(){return this._ez_data}}class d extends l{constructor(e){super(),this.type=e||"div",this._attr={class:[],value:void 0,id:void 0},this.children=[],this._listener={},this.ezText=null,this.parent=null}on(e,t,s){this._listener[e]=t.bind(s||this),o.commit(o.shell_mod,o.ctrl_event,this,null)}off(e,t){delete this._listener[e],o.commit(o.shell_mod,o.ctrl_event,this,null)}add(e){return e.parent=this,this.children.push(e),o.commit(o.shell_add,o.ctrl_node,e,this),this}remove(e){for(var t=this.children.length-1;t>=0;t--){let s=this.children[t];if(e._elId===s._elId){this.children.splice(t,1);break}}for(var s in o.commit(o.shell_del,o.ctrl_node,e,this),this){let t=this[s];if(t&&t._ename&&t._eid===e._eid){this._ez_del_attr(s);break}}return e.parent=null,this}removeAll(){for(;this.children.length;)this.remove(this.children[0])}addAttr(e,t){this._attr[e]=t,o.commit(o.shell_mod,o.ctrl_attr,this,null)}removeAttr(e,t){delete this._attr[e],o.commit(o.shell_mod,o.ctrl_attr,this,null)}addClass(e){this._attr.class.push(e),o.commit(o.shell_mod,o.ctrl_attr,this,null)}removeClass(e){this._attr.class=this._attr.class.filter(t=>t!==e),o.commit(o.shell_mod,o.ctrl_attr,this,null)}set value(e){this._attr.value!==e&&(this._attr._value=e,o.commit(o.shell_mod,o.ctrl_text,this,null))}get value(){return this._attr._value}set id(e){this._attr.id!==e&&(this._attr.id=e,o.commit(o.shell_mod,o.ctrl_text,this,null))}get id(){return this._attr.id}set text(e){this.ezText||(this.ezText=new h,this.add(this.ezText)),this.ezText.text!==e&&(this.ezText.text=e)}get text(){return this.ezText?this.ezText.text:""}}class c extends d{constructor(){super("a"),this.addClass("link"),this.addAttr("href","javascript:")}}class u extends d{constructor(){super("img")}set src(e){this._attr.src=e}get src(){return this._attr.src}}class m extends d{}class _ extends d{constructor(){super("input")}}class v{constructor(){this.container=null,this.routerArray=[],this.routerMap=new Map,this.history=[],this.currentRouteName=""}set routers(e){this.routerArray=e,e.forEach(e=>{this.routerMap.set(e.name,e)})}add(e,t){let s={name:e,node:t};this.routers.push(s),this.routerMap.set(e,s)}to(e){if(e===this.currentRouteName)return;let t=this.routerMap.get(e).node;if(this.container.add(t),this.history.length){let e=this.history[this.history.length-1];this.container.remove(e)}this.history.push(t),this.currentRouteName=e}back(){if(this.history.length>1){let e=this.history.pop();this.container.remove(e),e=this.history.pop(),this.container.add(e)}}}var p=new class{constructor(){this.type="Body",this.Node=d,this.Link=c,this.Image=u,this.Video=m,this.Input=_,this.Router=v,this.appId="app"}render(e){a.init(e,this.appId)}renderTo(e,t){this.appId=t,this.render(e)}};export default p;
